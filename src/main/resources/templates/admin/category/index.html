<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head th:replace="admin/layout::header"></head>
<link href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
<!-- JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>

<!-- CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
<!-- Default theme -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
<!-- Semantic UI theme -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.min.css"/>
<!-- Bootstrap theme -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/>

<!--
    RTL version
-->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.rtl.min.css"/>
<!-- Default theme -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.rtl.min.css"/>
<!-- Semantic UI theme -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.rtl.min.css"/>
<!-- Bootstrap theme -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.rtl.min.css"/>
<body>

<!-- start loader -->
<div th:replace="admin/layout::pageloader"></div>
<!-- end loader -->
<!-- Start wrapper-->
 <div id="wrapper">

     <div th:replace="admin/layout::sidebar"></div>

     <!--Start topbar header-->
     <header th:replace="admin/layout::navbar"></header>
     <!--End topbar header-->

<div class="clearfix"></div>

  <div class="content-wrapper">
    <div class="container-fluid">
      <!-- Breadcrumb-->
     <div class="row pt-2 pb-2">
        <div class="col-sm-9">
		    <h4 class="page-title">Data Tables</h4>
		    <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="javaScript:void();">Dashtreme</a></li>
            <li class="breadcrumb-item"><a href="javaScript:void();">Tables</a></li>
            <li class="breadcrumb-item active" aria-current="page">Data Tables</li>
         </ol>
	   </div>
	   <div class="col-sm-3">
       <div class="btn-group float-sm-right">
           <a href="javascript:void(0);" class="btn btn-primary"
              onclick="category.addNew()">Add Category</a>
      </div>
     </div>
     </div>
    <!-- End Breadcrumb-->
      <div class="row">
        <div class="col-lg-12">
          <div class="card">
            <div class="card-header"><i class="fa fa-table"></i> Data Table Example</div>
            <div class="card-body">
              <div class="table-responsive">
              <table name="tblPostContent" id="tblCategory" class="table table-striped table-hover  table-bordered">
              </table>
            </div>
            </div>
          </div>
        </div>
      </div><!-- End Row-->
        <!-- The Modal -->
        <div class="modal" id="modalAddEdit" name="modalAddEdit">
            <div class="modal-dialog">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title" id="modalTitle" th:name="modalTitle"></h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        <form id="formAddEdit" th:name="formAddEdit">
                            <input hidden name="id" id="id" >
                            <div class="row form-group">
                                <div class="col-3"></div>
                                <div class="col-9"><p id="m1" name="m1" type="text"></p></div>
                            </div>
<!--                            <div class="row form-group">-->
<!--                                <div class="col-3">-->
<!--                                    <label>Category Id</label>-->
<!--                                </div>-->
<!--                                <div class="col-9">-->
<!--                                    <select class="form-control" name="titleId" id="titleId"></select>-->
<!--                                </div>-->
<!--                            </div>-->
                            <div class="row form-group">
                                <div class="col-3">
                                    <label>Category Title</label>
                                </div>
                                <div class="col-9">
                                    <input class="form-control" type="text"
                                           name="title" id="title"
                                           placeholder="Title" required minlength="3" maxlength="20">
                                </div>
                            </div>


                        </form>
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <a href="javascript:" class="btn btn-primary"
                           onclick="category.save()">Save</a>

                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>

                </div>
            </div>
        </div>


<!--start overlay-->
		  <div class="overlay toggle-menu"></div>
		<!--end overlay-->
    </div>
    <!-- End container-fluid-->

    </div><!--End content-wrapper-->
   <!--Start Back To Top Button-->
    <a href="javaScript:void();" class="back-to-top"><i class="fa fa-angle-double-up"></i> </a>
    <!--End Back To Top Button-->

     <!--Start footer-->
     <footer th:replace="admin/layout::footer"></footer>
     <!--End footer-->

     <!--start color switcher-->
     <div th:replace="admin/layout::theme"></div>
     <!--end color switcher-->

  </div><!--End wrapper-->
<th:block th:replace="admin/layout::Js"></th:block>
<!--Data Tables js-->
<!--<script src="/assets-admin/plugins/bootstrap-datatable/js/jquery.dataTables.min.js"></script>-->
<!--<script src="/assets-admin/plugins/bootstrap-datatable/js/dataTables.bootstrap4.min.js"></script>-->
<!--<script src="/assets-admin/plugins/bootstrap-datatable/js/dataTables.buttons.min.js"></script>-->
<!--<script src="/assets-admin/plugins/bootstrap-datatable/js/buttons.bootstrap4.min.js"></script>-->
<!--<script src="/assets-admin/plugins/bootstrap-datatable/js/jszip.min.js"></script>-->
<!--<script src="/assets-admin/plugins/bootstrap-datatable/js/pdfmake.min.js"></script>-->
<!--<script src="/assets-admin/plugins/bootstrap-datatable/js/vfs_fonts.js"></script>-->
<!--<script src="/assets-admin/plugins/bootstrap-datatable/js/buttons.html5.min.js"></script>-->
<!--<script src="/assets-admin/plugins/bootstrap-datatable/js/buttons.print.min.js"></script>-->
<!--<script src="/assets-admin/plugins/bootstrap-datatable/js/buttons.colVis.min.js"></script>-->
<!--Data Tables js-->
<script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js"></script>
<script>
    var category = {} || category;
    category.intTable = function() {
        $("#tblCategory").DataTable({
            ajax: {
                // url: 'https://localhost:8080/api/category',
                url: 'https://techblogsvn.herokuapp.com/api/category',
                method: "GET",
                datatype: "json",
                dataSrc: ""
            },
            columns: [
                { data: "id" , name: "id", title: "Id"},
                {data: "title", name: "Name", title: "Title", orderable: true},
                {
                    data: "id", name: "Action", title: "Action", sortable: false,
                    orderable: false, render: function (data, type, row, meta) {
                        var str = "<a href='javascript:;' title='edit product' onclick='category.get(" + data + ")'><i class='fa fa-edit'></i></a> " +
                            "<a href='javascript:;' title='remove product' onclick='category.delete(" + data + ")' ><i class='fa fa-trash'></i></a>"
                        return str;
                    }
                }
                // { "pagingType": "full_numbers" }
            ]
        });
    };
    category.initCategory = function(){
        $.ajax({
            // url : "https://localhost:8080/api/category/",
            url: 'https://techblogsvn.herokuapp.com/api/category',
            method : "GET",
            dataType : "json",
            success : function(data){
                $('#titleId').empty();
                $.each(data, function(i, v){
                    $('#titleId').append(
                        "<option value='"+ v.id +"'>" + v.title + "</option>"
                    );
                });

            }
        });
    };

    category.addNew = function(){
        $('#modalTitle').html("Add new Category");
        category.resetForm();
        $('#modalAddEdit').modal('show');
    };
    // category.initValidation = function () {
    //     $("#modalAddEdit").validate({
    //         rules: {
    //             title: {
    //                 require: true,
    //                 minlength: 3,
    //                 maxlength: 20,
    //             }
    //         },
    //         title: {
    //             title: "Please enter title"
    //         }
    //     });
    // }
    category.resetForm =function () {
        $('#formAddEdit')[0].reset();
        $('#title').val('');
    }
    category.get = function (id) {
        console.log('get:' + id);
        $.ajax({
            // url : "https://localhost:8080/api/category/" + id,
            url: 'https://techblogsvn.herokuapp.com/api/category' +id ,
            method : "GET",
            dataType : "json",
            success : function(data){
                console.log(data);
                $('#formAddEdit')[0].reset();
                $('#modalTitle').html("Edit Title");
                $('#id').val(data.id);
                $('#title').val(data.title);
                $('#titleId').val(data.id);
                $('#modalAddEdit').modal('show');
            }
        });
    }
    category.save = function() {
        if ($("#formAddEdit")) {
            if ($('#id').val() == 0) {
                var categoryObj = {};
                categoryObj.id = $('#id').val();
                categoryObj.title = $('#title').val();



                // var postContentObj = {};
                // postContentObj.id = $("#postContentObj").val();
                // postContentObj.id = $("#postContent option:selected").html();
                // messagesObj.postContent = postContentObj;

                $.ajax({
                    // url: "https://localhost:8080/api/category/",
                    url: 'https://techblogsvn.herokuapp.com/api/category' ,
                    method: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    data: JSON.stringify(categoryObj),
                    done: function () {
                        console.log("POST DONE");
                        $('#modalAddEdit').modal('hide');

                        $("#tblCategory").DataTable().ajax.reload();
                    },
                    success: function (data) {
                        console.log("POST success");
                        $('#modalAddEdit').modal('hide');
                        alertify.success('Created Success');
                        $("#tblCategory").DataTable().ajax.reload();

                    }
                });
            } else {
                var categoryObj = {};
                categoryObj.id = $('#id').val();
                categoryObj.title = $('#title').val();


                // var postContentObj = {};
                // postContentObj.id = $("#postContentObj").val();
                // postContentObj.id = $("#postContent option:selected").html();
                // messagesObj.postContent = postContentObj;

                $.ajax({
                    // url: "https://localhost:8080/api/category/" + categoryObj.id,
                    url: 'https://techblogsvn.herokuapp.com/api/category' + categoryObj.id,
                    method: "PUT",
                    dataType: "json",
                    contentType: "application/json",
                    data: JSON.stringify(categoryObj),
                    success: function (data) {
                        $('#modalAddEdit').modal('hide');
                        alertify.success('Edited Success');
                        $("#tblCategory").DataTable().ajax.reload();
                    }
                });
            }
        }
    };

    category.delete = function(id){
        bootbox.confirm({
            title: "Remove Category",
            message: "Do you want to remove this title?",
            buttons: {
                confirm: {
                    label: '<i class="fa fa-check"></i> Yes'
                },
                cancel: {
                    label: '<i class="fa fa-times"></i> No'
                }
            },
            callback: function (result) {
                if(result){
                    $.ajax({
                        // url : "https://localhost:8080/api/category/" + id,
                        url: 'https://techblogsvn.herokuapp.com/api/category' + id,
                        method: "DELETE",
                        dataType : "json",
                        success : function(data){
                            alertify.success('Deleted Success');
                            $("#tblCategory").DataTable().ajax.reload();
                        }
                    });
                }
            }
        })
    };

</script>
<script>
    category.init = function(){
        category.intTable();
        category.initCategory();
        // category.initValidation();
    };
    $(document).ready( function () {
        category.init();
    } );
</script>
<!--<script>-->
<!--        $.ajax({-->
<!--            // url: 'https://localhost:8080/api/postContent',-->
<!--            url: 'https://techblogsvn.herokuapp.com/api/postContent',-->

<!--                method: "GET",-->
<!--                datatype: "json",-->
<!--                dataSrc: ""-->
<!--        }).done(-->
<!--            function (data) {-->
<!--                console.log(data[0].content);-->
<!--            }-->
<!--        );-->
<!--</script>-->
</body>
</html>
